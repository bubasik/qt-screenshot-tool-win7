name: Build Qt Screenshot Tool

on:
  push:
    branches: [ main ]
  pull_request:
  workflow_dispatch:  # –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é –∏–∑ GitHub UI

jobs:
  build-windows:
    runs-on: windows-2022  # –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –æ–±—Ä–∞–∑, –Ω–æ —Å–æ–±–µ—Ä—ë–º –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ –¥–ª—è Win7
    
    strategy:
      matrix:
        arch: [x86, x64]  # –°–æ–±–∏—Ä–∞–µ–º –æ–±–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4

      - name: ‚öôÔ∏è Setup Python (–¥–ª—è aqtinstall)
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: üì¶ Install Qt 5.12.12 + MinGW
        run: |
          pip install aqtinstall==3.1.13
          # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º–µ–Ω–Ω–æ —Ç—É –≤–µ—Ä—Å–∏—é MinGW, —á—Ç–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å Win7
          aqt install-qt windows desktop 5.12.12 win${{ matrix.arch }} -m mingw73
        env:
          AQT_USE_CACHE: "1"  # –£—Å–∫–æ—Ä—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–±–æ—Ä–∫–∏

      - name: üîß Setup MinGW in PATH
        run: |
          $qtDir = "C:\Qt\5.12.12\mingw73_${{ matrix.arch }}"
          $mingwBin = "$qtDir\bin;$qtDir\..\Tools\mingw730_${{ matrix.arch }}\bin"
          echo "$mingwBin" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
          echo "Qt installed to: $qtDir"

      - name: üõ†Ô∏è Build project
        run: |
          qmake ScreenshotTool.pro "CONFIG+=release"
          mingw32-make -j4

      - name: üì¶ Deploy dependencies (windeployqt)
        run: |
          windeployqt --release --qmldir . release\ScreenshotTool.exe
        working-directory: release

      - name: üíæ Package artifacts
        run: |
          $arch = "${{ matrix.arch }}"
          $zipName = "ScreenshotTool-win${arch}-qt5.12.12.zip"
          Compress-Archive -Path "release\*" -DestinationPath $zipName
          echo "ARTIFACT_NAME=$zipName" | Out-File -FilePath $env:GITHUB_ENV -Append

      - name: üöÄ Upload to GitHub Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: ${{ env.ARTIFACT_NAME }}
          path: ${{ env.ARTIFACT_NAME }}
          retention-days: 30

  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–±–æ—Ä–∫–∞ –ø–æ–¥ Linux/macOS –¥–ª—è –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç–∏
  # build-linux:
  #   runs-on: ubuntu-22.04
  #   steps: ... (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π Qt —á–µ—Ä–µ–∑ aqt)
