name: Build Qt Screenshot Tool for Windows 7

on:
  push:
    branches: [ main ]
  pull_request:
  workflow_dispatch:

jobs:
  build-win32:
    runs-on: windows-2022
    defaults:
      run:
        shell: cmd

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Qt 5.12.12 (32-bit, MinGW)
        uses: jurplel/install-qt-action@v4
        with:
          version: '5.12.12'
          arch: 'win32_mingw73'
          cache: true
          cache-key-prefix: qt-win32-mingw73-5.12.12

      - name: ğŸ” Verify Qt installation
        run: |
          echo Checking qmake...
          qmake --version
          echo.
          echo Checking windeployqt...
          windeployqt --version
          echo.
          echo PATH contents:
          path

      - name: ğŸ› ï¸ Build project (Release)
        run: |
          qmake ScreenshotTool.pro "CONFIG+=release"
          mingw32-make -j4

      - name: ğŸ“¦ Deploy Qt dependencies
        run: |
          windeployqt --release release\ScreenshotTool.exe
        working-directory: release

      - name: ğŸ’¾ Package for Windows 7
        run: |
          powershell -Command "Compress-Archive -Path 'release\*' -DestinationPath 'ScreenshotTool-win32-qt5.12.12.zip' -Force"
        working-directory: .

      - name: ğŸš€ Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: ScreenshotTool-win32-qt5.12.12
          path: ScreenshotTool-win32-qt5.12.12.zip
          retention-days: 30

      - name: âœ… Success message
        if: success()
        run: |
          echo.
          echo ========================================
          echo  âœ… BUILD SUCCESSFUL!
          echo  ğŸ“¦ Artifact: ScreenshotTool-win32-qt5.12.12.zip
          echo  ğŸ’» Works on Windows 7 SP1 (32/64-bit)
          echo ========================================
