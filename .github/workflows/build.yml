name: Build Qt Screenshot Tool for Windows 7

on:
  push:
    branches: [ main ]
  pull_request:
  workflow_dispatch:

jobs:
  build-win32:
    runs-on: windows-2022
    defaults:
      run:
        shell: cmd

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Qt 5.12.12 (32-bit, MinGW)
        uses: jurplel/install-qt-action@v4
        with:
          version: '5.12.12'
          arch: 'win32_mingw73'
          modules: 'qttools'  # Required for windeployqt
          cache: true
          cache-key-prefix: qt-win32-mingw73

      - name: ğŸ” Verify Qt installation
        run: |
          qmake --version
          where qmake
          where windeployqt

      - name: ğŸ› ï¸ Build project (Release)
        run: |
          qmake ScreenshotTool.pro "CONFIG+=release"
          mingw32-make -j4

      - name: ğŸ“¦ Deploy Qt dependencies
        run: |
          windeployqt --release release\ScreenshotTool.exe
        working-directory: release

      - name: ğŸ’¾ Package for Windows 7
        run: |
          powershell -Command "Compress-Archive -Path 'release\*' -DestinationPath 'ScreenshotTool-win32-qt5.12.12.zip'"
        working-directory: .

      - name: ğŸš€ Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: ScreenshotTool-win32-qt5.12.12
          path: ScreenshotTool-win32-qt5.12.12.zip
          retention-days: 30

      - name: âœ… Success message
        if: success()
        run: |
          echo.
          echo ========================================
          echo  âœ… Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞ!
          echo  ğŸ“¦ ĞÑ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚: ScreenshotTool-win32-qt5.12.12.zip
          echo  ğŸ’» Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ½Ğ° Windows 7 SP1+
          echo ========================================
