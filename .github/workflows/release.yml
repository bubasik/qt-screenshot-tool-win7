name: üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–ª–∏–∑

on:
  push:
    tags:
      - 'v*'  # –¢—Ä–∏–≥–≥–µ—Ä –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–≥–∞ –≤–∏–¥–∞ v1.0.0, v2.1.3 –∏ —Ç.–¥.

permissions:
  contents: write  # –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–æ–≤

jobs:
  build-and-release:
    runs-on: windows-2022
    
    strategy:
      matrix:
        arch: [x86, x64]
    
    steps:
      - name: üì• Checkout –∫–æ–¥–∞
        uses: actions/checkout@v4

      - name: ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Qt 5.12.12 + MinGW
        run: |
          pip install aqtinstall==3.1.13
          aqt install-qt windows desktop 5.12.12 win${{ matrix.arch }} -m mingw73
        env:
          AQT_USE_CACHE: "1"

      - name: üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PATH –¥–ª—è MinGW
        run: |
          $qtDir = "C:\Qt\5.12.12\mingw73_${{ matrix.arch }}"
          $mingwBin = "$qtDir\bin;$qtDir\..\Tools\mingw730_${{ matrix.arch }}\bin"
          echo "$mingwBin" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

      - name: üõ†Ô∏è –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
        run: |
          qmake ScreenshotTool.pro "CONFIG+=release"
          mingw32-make -j4

      - name: üì¶ –î–µ–ø–ª–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        run: |
          windeployqt --release --qmldir . release\ScreenshotTool.exe
        working-directory: release

      - name: üíæ –£–ø–∞–∫–æ–≤–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
        run: |
          $arch = "${{ matrix.arch }}"
          $zipName = "ScreenshotTool-win${arch}-qt5.12.12.zip"
          Compress-Archive -Path "release\*" -DestinationPath "..\$zipName"
          echo "ARTIFACT_PATH=../$zipName" | Out-File -FilePath $env:GITHUB_ENV -Append
        working-directory: release

      - name: üöÄ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞ –Ω–∞ GitHub
        uses: softprops/action-gh-release@v2
        with:
          files: ${{ env.ARTIFACT_PATH }}
          tag_name: ${{ github.ref_name }}
          name: "–í–µ—Ä—Å–∏—è ${{ github.ref_name }}"
          body: |
            ‚ú® –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–µ—Ä–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Windows 7!
            
            ## –ß—Ç–æ –Ω–æ–≤–æ–≥–æ
            - –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –∑–∞—Ö–≤–∞—Ç —ç–∫—Ä–∞–Ω–∞
            - 4 —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è: –°–≤–µ—Ç–ª–∞—è, –¢—ë–º–Ω–∞—è, –ë–∏—Ä—é–∑–æ–≤–∞—è, –ú–∞—Ç—Ä–∏—Ü–∞
            - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PNG/JPEG + –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            
            ## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
            ‚úÖ Windows 7 SP1+ (—Ç—Ä–µ–±—É—é—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è KB2533623, KB2999226)
            ‚úÖ Windows 10/11
            
            ## –°–∫–∞—á–∞—Ç—å
            –í—ã–±–µ—Ä–∏—Ç–µ –∞—Ä—Ö–∏–≤ –ø–æ–¥ –≤–∞—à—É —Å–∏—Å—Ç–µ–º—É:
            - `ScreenshotTool-win32-qt5.12.12.zip` ‚Äî –¥–ª—è 32-–±–∏—Ç–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –ü–ö)
            - `ScreenshotTool-win64-qt5.12.12.zip` ‚Äî –¥–ª—è 64-–±–∏—Ç–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
